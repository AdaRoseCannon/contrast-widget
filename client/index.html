<html>
	<head>
		<link href='https://fonts.gstatic.com' rel='preconnect' crossorigin>
		<link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400,300,600,800' rel='stylesheet' type='text/css'>
		<link rel="stylesheet" href="https://build.origami.ft.com/v2/bundles/css?modules=o-grid@^4.0.0" />
		<meta http-equiv="cleartype" content="on" />
		<meta name="MobileOptimized" content="width" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimal-ui" />
		<meta name="HandheldFriendly" content="true" />
		<meta name="twitter:card" content="summary" />
		<meta name="twitter:site" content="@lady_ada_king" />
		<meta name="twitter:title" content="Contraster" />
		<meta name="twitter:description" content="Find potentially low contrast type." />
		<meta name="twitter:url" content="https://gh.ada.is/contrast-widget/" />
		<meta name="twitter:image" content="https://gh.ada.is/contrast-widget/images/screenshot.png">
		<title>Contraster</title>
		<style>

			html {
				background: #FFF0F5;
			}

			html, body {
				font-family: 'Open Sans', sans-serif;
				font-weight: 400;
				color: #333;
				margin: 0;
				padding: 0;
			}

			h1, h2, h3, h4, h5, h6 {
				font-weight: 300;
			}

			h2, h3 {
				margin: 2em 0 1.5em 0;
				border-bottom: 1px solid grey;
			}

			a {
				color: #336ACE;
			}

			h2 a {
				text-decoration: none;
			}

			.title {
				border-bottom: 1px solid #ccc;
				background: url(./images/pattern.svg);
				background-size: cover;
				margin: 0;
				padding: 2em 1em 1em 1em;
			}

			.title h1 {
				font-size: 2em;
				text-decoration: none;
			}

			.low-contrast-fg {
				color: #999;
			}

			.low-contrast-bg {
				background: #555;
			}

			.standout {
				box-shadow: 0 0 2em 0 #333;
				padding: 1em;
				display: inline-block;
				margin: 1em;
			}

			.bookmarklet {
				display: inline-block;
				background: #eee;
				border: 1px solid #ccc;
				padding: 0.3em;
				border-radius: 0.5em;
				text-decoration: none;
				color: black;
				cursor: move;
				cursor: copy;
				cursor: grab;
			}

			.lifted {
				position:relative;
				background:#fff;
				box-shadow:0 1px 4px rgba(0, 0, 0, 0.3), 0 0 40px rgba(0, 0, 0, 0.1) inset;
			}

			/* Lifted corners */

			.lifted:before,
			.lifted:after { 
				content: "";
				position: absolute; 
				z-index: -1;
				bottom:15px;
				left:3%;
				width:50%;
				height:20%;
				max-width:300px;
				box-shadow:0 15px 10px rgba(0, 0, 0, 0.7);
				transform:rotate(-3deg);
			}

			.lifted:after {
				right:3%; 
				left:auto;
				transform:rotate(3deg);
			}

			.code {
				font-family: monospace;
				display: inline;
			}

			pre {
				display: block;
				border: 1px solid rgba(100, 100, 100, 0.5);
				background: 1px solid rgba(100, 100, 100, 0.3);
				padding: 2em;
				border-radius: 1em;
				margin: 1em;
				overflow: auto;
				tab-size: 4;
			}

			footer {
				padding: 1em;
				border-top: 1px solid #ccc;
			}

		</style>
	</head>
	<body>
		<div class="title">
			<h1 style="display: inline-block;">Contrast analysis widget.</h1><br />
			<div style="display:inline-flex; align-items:center; justify-content: space-around; flex-wrap: wrap-reverse; flex-direction: column;">
				<span>By <a href="https://ada.is">Ada Rose Edwards</a>, <date>12 February 2016</date></span>
				<p><a href="https://twitter.com/Lady_Ada_King" style="display: none;" class="twitter-follow-button" data-show-count="true" data-size="large" data-dnt="true">Follow @Lady_Ada_King</a></p>
			</div>
		</div>
		<div class="o-grid-container"><div class="o-grid-row">
			<div data-o-grid-colspan="12 6 3" style="display:inline-flex; align-items:center; justify-content: space-around; flex-wrap: wrap-reverse; flex-direction: column;">
				<p><a href="https://twitter.com/Lady_Ada_King" class="twitter-follow-button" data-show-count="true" data-size="large" data-dnt="true">Follow @Lady_Ada_King</a></p>
			</div>
			<article data-o-grid-colspan="center 12 M11 L9">
				<p>It is important that sites maintain legibility of all their text content for all of their users. Low contrast text can make it very difficult for some readers to read some text.
				This was inspired by Lea Verou's <a href="http://leaverou.github.io/contrast-ratio/">Contrast Ratio</a> tool which works out the contrast between foreground and background colours and gives a numerical answer to whether it has enough contrast.</p>

				<p>In order to locate potential problem areas on a website I put together this tool which shows the distribution of contrast ratio and can highlight elements on the page with poor contrast.</p>

				<p>It's running automatically on this page and it is a bookmarklet so you can run it on almost any site provided the Content Security Policy allows.</p>

				<p>This tool was inspired by Lea Verou's work on site contrast and uses some code from her <a href="http://leaverou.github.io/contrast-ratio/">Contrast Ratio</a> utility.</p>

				<p><b>Drag the Bookmarklet to your bookmark bar:</b> &nbsp;<a href="javascript:<!-- @echo bm -->" class="bookmarklet lifted">Analyse Contrast</a></p>

				<h2 id="example"><a href="#example">Examples of bad contrast</a></h2>
				<p>Push the "Highlight Low Contrast Elements" button to see these highlighted.</p>
				<div>
					<div class="standout low-contrast-fg">
						Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book.
					</div>
					<div class="standout low-contrast-bg">
						Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
					</div>
				</div>

				<h2 id="automated-testing"><a href="#automated-testing">Scripts for automated testing</a></h2>
				<p>As well as a bookmarklet to enable it's use with automated tests I also compiled it as a script you can inject into the page once it has loaded. They can be configured to just show the graph or highlight the problem areas. The results are attached to the window so you can easily retrieve the results.</p>
				<p>
					Scripts you can inject with webdriver or put in your phantomjs script to perform analysis:
					<ul>
						<li><a href="./contrast-widget-bundle.es2015.js">es2015 Bundle</a></li> (Should work in recent chrome)
						<li><a href="./contrast-widget-bundle.min.js">es5 minified bundle (~60k)</a></li>
					</ul>
					These scripts will perform the analysis automatically and attach the results to the window (<span class="code">window.contrastWidgetData</span>.) The data format is as follows:
					<pre>
window.contrastWidgetData = {
	"badContrastNodes": [
		{
			"node": DOM Node,			 // Node which is below threshold
			"contrastRatio": 2.6		  // contrast ratio of the node
		}
	],
	"proportionBadContrast": 7.0495,	  // Proportion of characters below threshold
	"chartData": [ Number &#215; 16 ]		  // Data to produce the chart from 0 to >15,
	"highlightBadEls": Function		   // function to highlight bad elements
}
</pre>
				</p>

				<p>Optional: To configure the script inject into the page a settings object BEFORE you inject the script.</p>
				<pre>
window.contrastWidgetOptions = {
	badNodeCutOff: 4.5,		 // The threshold for poor contrast.
	showModal: true,		  // whether to show the modal with the graph
	highlightBadEls: false	// whether to highlight the bad nodes
}
				</pre>
				<h2 id="limitations"><a href="#limitations">Limitations</a></h2>
				<ul>
					<li>Background Images and Gradients will be ignored, but it is good practise for these to have a similar 'background-color' regardless to fall back to in case of a lack of gradient support or the image fails to load.</li>
					<li>Text in 0px<sup>2</sup> area DOM nodes which have background colour will still have that background colour used.</li>
					<li>The node highlighter will mis-highlight transformed elements (scale, translate etc..)</li>
					<li>highlighted 'position: fixed' elements will not match the highlight after a scroll</li>
				</ul>

				<h2 id="how-it-works"><a href="#how-it-works">How it works</a></h2>
				<p>The logic is pretty dumb, it iterates over all text nodes and collects their parent.</p>
				<p>We then iterate over the parents and use <span class="code">getComputedStyle</span> to measure the <span class="code">color</span></p>
				<p>We have to be a bit smarter for the background we traverse up the tree until we find a parent with a background.</p>
				<p>These values are then used with the color lib from Lea Verou's tool, to work out a value the contrast.</p>
				<p>We then sum the number of characters contained in that DOM node and use that to produce the small chart.</p>

				<h2 id="feature-reqs"><a href="#feature-reqs">Potential Additional Features</a></h2>
				<ul>
					<li>Identify type which is too small.</li>
				</ul>

				<h2 id="contribute"><a href="#contribute">Contribute</a></h2>
				<p><a href="https://github.com/AdaRoseEdwards/contrast-widget">Github Page with build instructions.</a></p>
			</article>
		</div></div>
		<footer>
			2016 - Ada Rose Edwards <span style="float: right;"><a href="https://twitter.com/Lady_Ada_King" class="twitter-follow-button" data-show-count="true" data-size="large" data-dnt="true">Follow @Lady_Ada_King</a></span>
				<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
		</footer>
		<script type="text/javascript" src="contrast-widget-bundle.min.js"></script>
	</body>
</html>
